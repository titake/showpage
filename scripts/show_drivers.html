<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>驾驶员列表</title>
	<link rel="icon" type="image/png" href="../images/icon_star2.png">  <!-- ./是当前目录   ../是上一级父目录    /是根目录  -->
	<link rel="stylesheet" type="text/css" href="../styles/logupCss.css">
	<link rel="stylesheet" type="text/css" href="../styles/mainCss.css">
	<style type="text/css">
		.view_tab_title{
			width: 20%;
			height: 50px;
			display: inline;
			background: rgba(255,255,255,0.8);
			cursor: pointer;
			justify-content: center;
			align-items: center;
		}
		.text_title_tab{
			font-size: 16px;
			font-weight: 400;
			font-family: 宋体;
			text-align: center;
			color: rgb(0,0,0);
		}
		.text_title{
			font-size: 16px;
			font-weight: 400;
			font-family: 宋体;
			text-align: center;
			width: 80px;
			color: rgb(0,0,0);
			cursor: pointer;
			text-decoration: none;
		}
		
		/*首页主界面*/
		#id_page_main{
			width:100%;
			height: 560px;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-end;
			position: absolute;
			left: 0px;
			top: 50px;
		}
		#text_main{
			height: 60px;  
			margin: 0px;
			font-size: 50px;
			color: rgb(25,26,27);
			cursor: default;  
			margin-bottom: 250px;  
		}
		.view_misdeeds{
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-items:center;
		}
		.text_ulName{
			font-size: 16px;
			font-weight: 400;
			font-family: 宋体;
			text-align: center;
			color: rgb(0,0,0);
			margin-top: 10px;
			margin-bottom: 10px;
		}
		.ul_misdeed{
			margin: 0px;
			padding: 0px;
			display: flex;
			flex-direction: column;
			width: 960px;
		}
		.li_content{
			height: 40px;
			width: 840px;
			display: flex;
			flex-direction: row;
			justify-content: flex-start;
			align-items: center;
			font-size: 14.5px;
			font-weight: 400;
			font-family: 宋体;
			text-align: left;
		}
		.text_normal{
			font-size: 14.5px;
			font-weight: 400;
			font-family: 宋体;
			text-align: left;
			margin: 0px;
			padding: 0px;
		}
		.view_content{
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-content: flex-start;
			margin-left: 16px;
			margin-right: 16px;
			width: 968px;
		}
		.view_toolbar{
			margin-top: 16px;
			width: 968px;
			display: flex;
			flex-direction: row;
			justify-content: flex-end;
			align-items: center;
		}
		.input_search{
			margin-left: 60px;
			width: 114px;
			height: 30px;
			padding-left: 6px;
			border: solid 1px #aaa;
			border-right: dashed 1px #ccc;
			border-radius: 3px 0px 0px 3px;
		}
		.select_search{
			margin: 0px;
			padding-left: 6px;
			width: 94px;
			height: 34px;
			border: solid 1px #aaa;
			border-left: none;
			border-radius: 0px 3px 3px 0px;
		}
		.text_option{
			margin: 0px;
			padding-left: 6px;
			width: 94px;
		}
		.ul_content{
			display: flex;
			padding: 0px;
			margin: 0px;
			margin-top: 16px;
			flex-direction: column;
			width: 820px;
			border: solid 1px #aaa;
			border-radius: 1px;
		}
		.li_content{
			list-style-type: none;
			padding: 0px;
			margin: 0px;
			width: 800px;
			height: 40px;
			padding-left: 10px;
			padding-right: 10px;
			display: flex;
			flex-direction: row;
			justify-content: flex-start;
			align-items: center;
			cursor: pointer;
		}
	</style>
	<script type="text/javascript" src="../styles/myjs.js"></script>
	<script type="text/javascript" src="../lib/jquery-3.2.0.js"></script>
</head>
<body>
	<!--titleBar-->
	<div class="view_title">
		<div class="view_title_left">
			<div id="id_tab_main" class="view_tab_title" onmouseover="turnToBlur('id_tab_main')" onmouseout="turnToClear('id_tab_main')" onclick="window.location.href = 'hello.html'">
				<p class="text_title_tab">首页</p>
			</div>
			<div id="id_tab_transform" class="view_tab_title" style="background-color: transparent;"  onmouseover="turnToBlur('id_tab_transform')" onmouseout="turnToClear('id_tab_transform')" onclick="window.location.href = 'hello_transform.html'">
				<p class="text_title_tab">道路运输</p>
			</div>
			<div id="id_tab_teach" class="view_tab_title" onmouseover="turnToBlur('id_tab_teach')" onmouseout="turnToClear('id_tab_teach')" onclick="window.location.href = 'hello_teach.html'">
				<p class="text_title_tab">驾校</p>
			</div>
			<div id="id_tab_maintain" class="view_tab_title" onmouseover="turnToBlur('id_tab_maintain')" onmouseout="turnToClear('id_tab_maintain')" onclick="window.location.href = 'hello_maintain.html'">
				<p class="text_title_tab">车辆维护</p>
			</div>
			<div id="id_tab_transport" class="view_tab_title" onmouseover="turnToBlur('id_tab_transport')" onmouseout="turnToClear('id_tab_transport')" onclick="window.location.href = 'hello_transport.html'">
				<p class="text_title_tab">客运站</p>
			</div>
		</div>
		<div class="view_title_right" id="id_div_dologup">
			<a class="text_title" href="login.html" id="id_btn_login" style="margin-right: 10px" onmouseover="turnToBlur('id_btn_login')" onmouseout="turnToClear('id_btn_login')">登录</a>
			<a class="text_title" href="logup_Step1.html" id="id_btn_logup" style="margin:0px 100px 0px 20px" onmouseover="turnToBlur('id_btn_logup')" onmouseout="turnToClear('id_btn_logup')">注册</a> 
		</div>
		<div class="view_title_right" id="id_div_user" style="display: none" >
			<a class="text_user" id="id_icon_user"  style="margin-right: 50px;" onmouseover="turnToBlur('id_btn_login')" onmouseout="turnToClear('id_btn_login')" onclick="toggleAdmin()"></a>
		</div>
	</div>

	<ul id="id_div_userAdmin" class="view_userAdmin" style="display: none;">
		<!-- <li id="id_user_edit" class="option_userAdmin" onclick="turnToEdit()"> 
			<img class="img_icon" src="../images/set.png"><p class="text_user" style="width: 80px;">个人设置</p>
		</li> -->
		<li id="id_user_admin" class="option_userAdmin" onclick="location.href='admin.html'">
			<img class="img_icon" src="../images/admin.png"><p class="text_user" style="width: 80px;">信息管理</p>
		</li>
		<li id="id_user_logout" class="option_userAdmin" style="border-bottom: none;" onclick="logout()">
			<img class="img_icon" src="../images/logout.png"><p class="text_user" style="width: 80px;">退出登录</p>
		</li>
	</ul>
	<!--内容-->
	<div class="view_misdeeds" id="id_view_misdeed">
		<div class="view_toolbar">
			<input type="text" class="input_search" id="id_where_driver">
			<select class="select_search" id="id_options_driver">
				<option class="text_option">姓名</option>
				<option class="text_option">性别</option>
				<option class="text_option">驾驶证号</option>
				<option class="text_option">档案编号</option>
				<option class="text_option">从业资格证号</option>
				<option class="text_option">联系电话</option>
			</select>
			<img src="../images/search.png" class="img_icon" style="margin-left: 6px;cursor: pointer;" onclick="searchDriver()">
		</div>
		<div class="view_content" style="margin-top: 20px;align-items: center;width: 960px;">
			<p class="text_ulName" id="id_ulName">xxx违规列表</p>
			<ul class="ul_content" id="id_ul_drivers">
				<li class="li_content">
				</li>
			</ul>
		</div>
	</div>
	<div class="view_footer" style="margin-top: 50px;">
		<p class="text_footer">Copyright © 2016-2017 titake All Rights Reserved.</p>
	</div>
	<script type="text/javascript">
		user_email="";
		usertype = "";
		var request = new XMLHttpRequest;
		request.open("GET","../ajax/queryCookie.php?name=user_email",true);
		request.send();
		request.onreadystatechange = function(){
			if (request.readyState===4) {
				if (request.status===200) {
					var result = JSON.parse(request.responseText);
					if (result.success) {
						user_email=result.value;
						request.open("GET","../ajax/getData_sql.php?flag=userType&user_email="+user_email,true);
						request.send();
						request.onreadystatechange = function(){
							if (request.readyState===4) {
								if (request.status===200) {
									console.log(request.responseText);
									var result = JSON.parse(request.responseText);
									usertype = result.userType;
									if (usertype.search(/管理员$/g)>-1) {
										document.getElementById("id_user_admin").style.display="flex";
									}else{
										document.getElementById("id_user_admin").style.display="none";
									}
								}else{
									alert("error:"+request.status);
								}
							}
						}
						$(function(){
							$("#id_div_dologup").hide();
							$("#id_icon_user").html(result.value);
							$("#id_div_user").show();
						});
					}else{
						user_email="";
						$(function(){
							$("#id_div_user").hide();
							$("#id_div_dologup").show();
						});
					}
				}else{
					alert("error:"+request.status);
				}
			}
		}

		function toggleAdmin(){
			$(function(){
				$("#id_div_userAdmin").toggle("normal");
			});
		}
	// function turnToEdit(){
		// 	switch(usertype) {
		// 		case '驾驶员/教练员':
		// 			window.location.href='logup_Step2_driver.html?type=edit';
		// 			break;
		// 		case '维修工人':
		// 			window.location.href='show_maintainer_one.html?type=edit';
		// 			break; 
		// 		case '客运站员工':
		// 			window.location.href='show_staff_one.html?type=edit';
		// 			break; 
		// 		case '运输公司/驾校管理人员':
		// 			window.location.href='show_administer_one.html?type=edit';
		// 			break; 
		// 		case '维护公司管理人员':
		// 			window.location.href='show_administer_one.html?type=edit';
		// 			break; 
		// 		case '客运站管理人员':
		// 			window.location.href='show_administer_one.html?type=edit';
		// 			break; 
		// 		case '超级管理员':
		// 			window.location.href='show_administer_one.html?type=edit';
		// 			break; 
		// 		case '乘客/学员':
		// 			window.location.href='show_passenger_one.html?type=edit';
		// 			break; 
		// 	}
	// }
		function getDriverUl(){
			$(function(){
				$("#id_ulName").html("驾驶员列表");
			})
			var sql = "select idcard_num,username,sex,job_permi_classify,ifblock,star_polite,star_safe,star_law,star_honest,star_server from tb_driver;";
			var request = new XMLHttpRequest;
			request.open("GET","../ajax/getData_sql.php?flag=drivers&sql="+sql,true);
			request.send();
			request.onreadystatechange = function(){
				if (request.readyState===4) {
					if (request.status===200) {
						var result = JSON.parse(request.responseText);
						console.log(result);
						var inner="";
						if (result.length>0) {
							inner = inner+'<li class="li_content" style="border-bottom:solid 1px #888;justify-content:flex-start;"><p class="text_normal" style="width: 80px;">姓名</p><p class="text_normal" style="width: 40px;margin-left: 10px;">性别</p><p class="text_normal" style="width: 130px;margin-left: 20px;margin-right:25px;">从业资格类别</p><p class="text_normal" style="width: 70px;text-align:center;">文明星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">安全星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">守法星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">诚信星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">服务星</p></li>';
							for (var m = 0; m<result.length; m++) {
								var j = "list"+m;
								inner = inner+'<li class="li_content" index="'+m+'"><p class="text_normal" style="width: 90px;">'+result[j]['username']+'</p><p class="text_normal" style="width: 15px;margin-left: 20px;">'+result[j]['sex']+'</p><p class="text_normal" style="width: 140px;margin-left: 20px;margin-right:25px;">'+result[j]['job_permi_classify']+'</p>';
								var ifblock = result[j]['ifblock'];
								if (ifblock==1) {
									inner = inner+'<p class="text_normal" style="width: 400px;margin-left: 20px;">该驾驶员在黑名单中';
								}else{
									var star_polite = result[j]['star_polite'];
									var i=1;
									while(i<=star_polite){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_polite++;
									while(star_polite<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_polite++;
									}

									var star_safe = result[j]['star_safe'];
									if (star_safe>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										star_safe++;
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
									}
									i=2;
									while(i<=star_safe){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_safe++;
									while(star_safe<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_safe++;
									}
									var star_law = result[j]['star_law'];
									if (star_law>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
										star_law++;
									}
									i=2;
									while(i<=star_law){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_law++;
									while(star_law<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_law++;
									}
									var star_honest = result[j]['star_honest'];
									if (star_honest>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
										star_honest++
									}
									i=2;
									while(i<=star_honest){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_honest++;
									while(star_honest<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_honest++;
									}
									var star_server = result[j]['star_server'];
									if (star_server>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
										star_server++;
									}
									i=2;
									while(i<=star_server){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_server++;
									while(star_server<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_server++
									}
								}
								inner = inner+ '<p class="p_btn" title="li_edit"></p>';
							}
						}else{
							console.log(result.reason);
						}
						$(function(){
							$("#id_ul_drivers").html(inner);
							$("#id_ul_drivers >li:even").css("background-color","rgba(220,220,220,0.8)");
							$("#id_ul_drivers >li:odd").css("background-color","rgba(250,250,250,0.8)");
							$("#id_ul_drivers >li").mouseover(function(){$(this).css("background-color","rgba(230,230,230,0.9)")});
							$("#id_ul_drivers >li:even").mouseout(function(){$(this).css("background-color","rgba(220,220,220,0.8)")});
							$("#id_ul_drivers >li:odd").mouseout(function(){$(this).css("background-color","rgba(250,250,250,0.8)")});
							$("#id_ul_drivers >li>p[title='li_edit']").prevAll().click(function(){
								window.open("show_driver_one.html?sessionName=idcard_num"+$(this).parent().attr("index"),"_blank");
							});
							$("#id_admin_driver").css("display","flex");
						});
					}else{
						alert("error:"+request.status);
					}
				}
			}
		}
		function searchDriver(){
			var sql = "select idcard_num,username,sex,job_permi_classify,ifblock,star_polite,star_safe,star_law,star_honest,star_server from tb_driver where ";
			var selectOptions = document.getElementById("id_options_driver");
			var sindex = selectOptions.selectedIndex;
			var reference = selectOptions.options[sindex].value;
			var where = document.getElementById("id_where_driver").value;
			switch(reference){
				case '姓名':
					sql = sql+"username like '%"+where+"%';";
					break;
				case '性别':
					sql = sql+"sex like '%"+where+"%';";
					break;
				case '驾驶证号':
					sql = sql+"driveLicence_id like '%"+where+"%';";
					break;
				case '档案编号':
					sql = sql+"driverLicence_num like '%"+where+"%';"
					break;
				case '从业资格证号':
					sql = sql+"job_permi_id like '%"+where+"%';";
					break;
				case '联系电话':
					sql = sql+"phonenum like '%"+where+"%';";
					break;
			}
			var request = new XMLHttpRequest;
			request.open("GET","../ajax/getData_sql.php?flag=dosql&sql="+sql,true);
			request.send();
			request.onreadystatechange = function(){
				if (request.readyState===4) {
					if (request.status===200) {
						var result = JSON.parse(request.responseText);
						console.log(result);
						var inner="";
						if (result.length>0) {
							inner = inner+'<li class="li_content" style="border-bottom:solid 1px #888;justify-content:flex-start;"><p class="text_normal" style="width: 80px;">姓名</p><p class="text_normal" style="width: 40px;margin-left: 10px;">性别</p><p class="text_normal" style="width: 130px;margin-left: 20px;margin-right:25px;">从业资格类别</p><p class="text_normal" style="width: 70px;text-align:center;">文明星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">安全星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">守法星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">诚信星</p><p class="text_normal" style="width: 70px;margin-left:20px;text-align:center;">服务星</p></li>';
							for (var m = 0; m<result.length; m++) {
								var j = "list"+m;
								inner = inner+'<li class="li_content" index="'+m+'"><p class="text_normal" style="width: 90px;">'+result[j]['username']+'</p><p class="text_normal" style="width: 15px;margin-left: 20px;">'+result[j]['sex']+'</p><p class="text_normal" style="width: 140px;margin-left: 20px;margin-right:25px;">'+result[j]['job_permi_classify']+'</p>';
								var ifblock = result[j]['ifblock'];
								if (ifblock==1) {
									inner = inner+'<p class="text_normal" style="width: 400px;margin-left: 20px;">该驾驶员在黑名单中';
								}else{
									var star_polite = result[j]['star_polite'];
									var i=1;
									while(i<=star_polite){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_polite++;
									while(star_polite<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_polite++;
									}

									var star_safe = result[j]['star_safe'];
									if (star_safe>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										star_safe++;
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
									}
									i=2;
									while(i<=star_safe){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_safe++;
									while(star_safe<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_safe++;
									}
									var star_law = result[j]['star_law'];
									if (star_law>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
										star_law++;
									}
									i=2;
									while(i<=star_law){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_law++;
									while(star_law<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_law++;
									}
									var star_honest = result[j]['star_honest'];
									if (star_honest>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
										star_honest++
									}
									i=2;
									while(i<=star_honest){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_honest++;
									while(star_honest<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_honest++;
									}
									var star_server = result[j]['star_server'];
									if (star_server>0) {
										inner = inner+'<img class="img_star" src="../images/star_gold.png" style="margin-left:20px;">';
									}else{
										inner = inner+'<img class="img_star" src="../images/star_gray.png" style="margin-left:20px;">';
										star_server++;
									}
									i=2;
									while(i<=star_server){
										inner = inner+'<img class="img_star" src="../images/star_gold.png">';
										i++;
									}
									star_server++;
									while(star_server<=5){
										inner = inner+'<img class="img_star" src="../images/star_gray.png">';
										star_server++
									}
								}
								inner = inner+ '<p class="p_btn" title="li_edit"></p>';
							}
						}else{
							console.log(result.reason);
						}
						$(function(){
							$("#id_ul_drivers").html(inner);
							$("#id_ul_drivers >li:even").css("background-color","rgba(220,220,220,0.8)");
							$("#id_ul_drivers >li:odd").css("background-color","rgba(250,250,250,0.8)");
							$("#id_ul_drivers >li").mouseover(function(){$(this).css("background-color","rgba(230,230,230,0.9)")});
							$("#id_ul_drivers >li:even").mouseout(function(){$(this).css("background-color","rgba(220,220,220,0.8)")});
							$("#id_ul_drivers >li:odd").mouseout(function(){$(this).css("background-color","rgba(250,250,250,0.8)")});
							$("#id_ul_drivers >li>p[title='li_edit']").prevAll().click(function(){
								window.open("show_driver_one.html?sessionName=idcard_num"+$(this).parent().attr("index"),"_blank");
							});
							$("#id_admin_driver").css("display","flex");
						});
					}else{
						alert("error:"+request.status);
					}
				}
			}
		}
		getDriverUl();
	</script>
</body>
</html> 