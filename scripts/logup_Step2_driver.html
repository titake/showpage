<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>驾驶员信息</title>
	<link rel="icon" type="image/png" href="../images/icon_star2.png">
	<link rel="stylesheet" type="text/css" href="../styles/logupCss.css">
	<script type="text/javascript" src="../styles/myjs.js"></script>
	<script type="text/javascript" src="../lib/jquery-3.2.0.js"></script>
	<style type="text/css">
		/*内容*/
		.view_container{
			margin: 0px;
			width: 900px;
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-items: center;
		}
		/*驾驶员信息模块样式*/
		.view_driverInfo{
			display: flex;
			flex-direction: column;
			width: 960px;
			justify-content: flex-start;
			align-items: center;
		}
		/*子模块样式*/
		.view_BigDiv_info{
			display: flex;
			flex-direction: column;
			width: 820px;
			justify-content: flex-start;
			align-items: center;
			border: none;
			border-bottom: dashed 1px #a0a0a0;
			padding-bottom: 50px;
			padding-top: 14px;
		}
		.text_DivName{
			width: 820px;
			font-size: 14.5px;
			font-family: 黑体;
			color: #585858;
			font-weight: 600;
			margin-bottom: 30px;
			text-align: center;			
		}
		/*子模块中每行div的样式*/
		.text_input{
			width: 220px;
			height: 34px;
			font-family: 宋体;
			font-size: 14.5px;
			color: #585858;
			padding-left: 20px;
			overflow: hidden;
			border: solid;
			border-color: #DBDBDB;
			border-width: 1px;
			border-radius: 4px;
			margin: 0px 40px 0px 5px;
		}
		.text_chexbox{
			width: 55px;
			height: 30px;
			margin: 0px;
			font-size: 14.5px;
			font-family: 宋体;
			color: #585858;
			font-weight: 600;
			display: inline;
			text-align: left;
		}
		.checkbox_css{
			font-family: 宋体;
			font-size: 14.5px;
			color: #585858;
			margin-left: 8px;
		}
		.content_item_column{
			display: flex;
			flex-direction: column;
			width: 120px;
			align-items: flex-start;
			justify-content: flex-start;
		}
		.content_item_row{
			display: flex;
			flex-direction: row;
			width: 276px;
			align-items: flex-start;
		}
		.img_driver{
			width: 140px;
			height: 140px;
			margin-left: 10px;
			background-image: url('../images/up.png');
			background-size: contain;
			background-repeat: no-repeat;
			background-position: center;
		}
		.textPs_item{
			font-size: 14.5px;
			color: #959595;
			margin-top: 8px;
		}
		.text_option{
			width: 180px;
			height: 34px;
			font-family: 宋体;
			font-size: 14.5px;
			color: #585858;
			padding-left: 20px;
			overflow: hidden;
			border: solid;
			border-color: #DBDBDB;
			border-width: 1px;
			border-radius: 4px;
			margin-left: 5px;
		}
		.btn_logup{
			width: 120px;
			height: 38px;
			background: #00B20B;
			border: none;
			border-radius: 4px;
			color: #fff;
			padding: 0px;
			text-align: center;
			font-size: 14.5px;
			margin-bottom: 50px;
		}
		.view_left{
			width: 352.5px;
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-items: flex-end;
		}
		.view_right{
			width: 352.5px;
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			align-items: flex-start;
			padding-top: 10px;
			padding-bottom: 10px;
			border-left: dotted 1px #999;
		}
		.btn_block{
			height: 40px;
			width: 120px;
			background: rgba(90,90,90,0.9);
			color: rgba(255,255,255,0.9);
			font-family: 黑体;
			font-size: 14.5px;
			border-radius: 2px;
			border: none;
			margin-right: 35px;
		}
		.div_star{
			margin-left: 35px;
			flex-direction: row;
			justify-content: flex-start;
			align-items: flex-end;
		}
	</style>
</head>
<body>
	<div class="view_title">
		<div class="view_title_name">
			<img class="img_title" src="../images/login_back.jpg">
			<p class="text_title">汽车评星系统 | 注册</p>
		</div>
		<div class="view_title_client">
		<!-- 这里先留着，回来如果需要的话，可以加一个用户的图标，是space-between的效果 -->
		</div>
	</div>
	<div class="view_container">
		<ul class="view_tab">
			<li class="text_tab" style="margin-left:0px;">
				<h4>①步骤一</h4>
			</li>
			<li class="text_tab" style="color:#01CE3F;font-weight: 500;">
				<h4>②步骤二</h4>
			</li>
			<li class="text_tab">
				<h4>③步骤三</h4>
			</li>
		</ul>
		<div class="view_content_column">

			<!--司机的信息完善-->
			<div class="view_driverInfo">
				<!--基本信息模块-->
				<div class="view_BigDiv_info">
					<p class="text_DivName">基本信息</p>
					<div class="view_ItemDiv_info">
						<div class="content_item_column">
							<p class="text_inputName">照片</p>
							<p class="textPs_item" style="margin-bottom: 40px;">两寸免冠近照</p>
						</div>
						<div class="img_driver" id="id_div_photo">
							<form action="../admin/uploadDriverPhoto.php" enctype="multipart/form-data" method="post" id="id_form_img">
								<input type="file" style="opacity: 0;filter: alpha(opacity=10);width: 150px;height: 150px;" name="photo_driver" onchange="document.getElementById('id_form_img').submit()">
							</form>
						</div>
						<p class="text_warn" id="id_warn_photo" style="display: none;margin-left: 20px;"></p>
					</div>
					<div class="view_ItemDiv_info">
						<p class="text_inputName">姓名</p>
						<input type="text" id="id_username" name="driver_name" onfocus="checkPhoto()" class="text_input" style="width: 80px" onchange="change(this)">
						<p class="text_inputName" style="text-align: center;">性别</p>
						<select class="text_option" style="width: 50px;padding-left: 6px;margin-right: 47px;" id="id_sex" onchange="change_select(this)">
							<option class="text_option" style="width: 50px;padding-left: 6px;">男</option>
							<option class="text_option" style="width: 50px;padding-left: 6px;">女</option>
						</select>
						<input class="text_input" type="text" placeholder="身份证号" maxlength="20" id="id_idcard_num" style="display: none;">
						<p class="text_warn" id="id_warn_name" style="display: none;">*</p>
					</div>
					<div class="view_ItemDiv_info">
						<p class="text_inputName">联系方式</p>
						<input type="text" name="driver_phone1" id="id_phonenum" maxlength="11" class="text_input" placeholder="手机号" style="margin-right: 76.8px;" onchange="change(this)">
						<input class="text_input" type="text" id="id_email" placeholder="邮箱" style="display: none;">
						<p class="text_warn" id="id_warn_phone" style="display: none;">*</p>
					</div>
					<div class="view_ItemDiv_info">
						<p class="text_inputName">通讯地址</p>
						<input type="text" id="id_address" name="driver_address" maxlength="80" class="text_input" style="width:611px; margin-right: 0px; " onchange="change(this)">
						<p class="text_warn" id="id_warn_address" style="display: none;">*</p>
					</div>
				</div>
				<!--驾驶信息模块-->
				<div class="view_BigDiv_info">
					<p class="text_DivName">驾驶证信息</p>
					<div class="view_ItemDiv_info">
						<p class="text_inputName">驾驶证号</p>
						<input id="id_driveLicence_id" maxlength="20" type="text" name="driver_phone1" class="text_input" style="margin-right: 33.8px;" onchange="change(this)">
						<p class="text_inputName" style="width: 113px;">初次领证日期</p>
						<input id="id_date_getLice" class="text_input" type="date" name="driverLicense_gainTime" style="margin-right: 0px;" onchange="change(this)">
						<p class="text_warn" id="id_warn_driveLicence" style="display: none;">*</p>
					</div>
					<div class="view_ItemDiv_info">
						<p class="text_inputName">档案编号</p>
						<input id="id_driverLicence_num" type="text" name="driver_phone1" class="text_input" style="margin-right: 33.8px;" onchange="change(this)">
						<div class="content_item_column" style="width: 80px;">
							<p class="text_inputName">准驾车型</p>
							<p class="textPs_item" style="margin-top: 0px;">多选</p>
						</div>
						<div class="content_item_column" style="width: 250px;">
							<div class="content_item_row">
								<p class="text_chexbox"><input type="checkbox" id="id_E" class="checkbox_css"> E</p>
								<p class="text_chexbox"><input type="checkbox" id="id_C3" class="checkbox_css"> C3</p>
								<p class="text_chexbox"><input type="checkbox" id="id_C2" class="checkbox_css"> C2</p>
								<p class="text_chexbox"><input type="checkbox" id="id_C1" class="checkbox_css"> C1</p>
								<p class="text_chexbox"><input type="checkbox" id="id_B2" class="checkbox_css"> B2</p>
							</div>
							<div class="content_item_row">
								<p class="text_chexbox"><input type="checkbox" id="id_B1" class="checkbox_css"> B1</p>
								<p class="text_chexbox"><input type="checkbox" id="id_A3" class="checkbox_css"> A3</p>
								<p class="text_chexbox"><input type="checkbox" id="id_A2" class="checkbox_css"> A2</p>
								<p class="text_chexbox"><input type="checkbox" id="id_A1" class="checkbox_css"> A1</p>
							</div>
						</div>
						<p class="text_warn" id="id_warn_permi" style="display: none;">*</p>
					</div>
				</div>
				<!--从业资格证信息模块-->
				<div class="view_BigDiv_info" id="id_div_permi" style="border-bottom: none;">
					<p class="text_DivName">从业资格证信息</p>
					<div class="view_ItemDiv_info">
						<p class="text_inputName" style="width: 113px;">从业资格证号</p>
						<input id="id_job_permi_id" type="text" name="driver_phone1" class="text_input"  onchange="change(this)">
						<p class="text_inputName">有效期至</p>
						<input id="id_job_permi_date" class="text_input" type="date" name="driverLicense_gainTime" style="margin-right: 0px;" onchange="change(this)">
						<p class="text_warn" id="id_warn_jobPermi" style="display: none;">*</p>
					</div>
					<div class="view_ItemDiv_info">
						<p class="text_inputName" style="width: 113px;">从业资格类别</p>
						<select class="text_option" id="id_job_permi_classify" onchange="change_select(this)"> 
							<option class="text_option">旅客运输</option>
							<option class="text_option">货物运输</option>
							<option class="text_option">危险货物运输</option>
							<option class="text_option">危险品押运员</option>
						</select>
						<p class="text_warn" id="id_warn_jobClassify" style="display: none;">*</p>
					</div>
				</div>
				<!--评星模块-->
				<div class="view_BigDiv_info" style="border-bottom: none;" id="id_div_star">
					<p class="text_DivName">评星信息</p>
					<div class="view_ItemDiv_info">
						<div class="view_left">
							<button class="btn_block" id="id_btn_block" onmouseover="turnToBlur('id_btn_block')" onmouseout="turnToClear('id_btn_block')" onclick="turnBlock()">加入黑名单</button>
						</div>
						<div class="view_right">
							<div class="div_star" id="id_star_polite">
								<p class="text_inputName" style="width: 36px;color:#444;">文明星</p>
								<img class="img_icon" id="id_star_polite1" onmouseover="wantToselect('id_star_polite1')" onmouseout="cancelWant('id_star_polite1')" onclick="selectStar('id_star_polite1')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_polite2" onmouseover="wantToselect('id_star_polite2')" onmouseout="cancelWant('id_star_polite2')" onclick="selectStar('id_star_polite2')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_polite3" onmouseover="wantToselect('id_star_polite3')" onmouseout="cancelWant('id_star_polite3')" onclick="selectStar('id_star_polite3')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_polite4"  onmouseover="wantToselect('id_star_polite4')" onmouseout="cancelWant('id_star_polite4')" onclick="selectStar('id_star_polite4')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_polite5"  onmouseover="wantToselect('id_star_polite5')" onmouseout="cancelWant('id_star_polite5')" onclick="selectStar('id_star_polite5')" src="../images/star_gray.png">
								<p class="text_warn" id="id_warn_star_polite" style="display: none;">*</p>
							</div>
							<div class="div_star" id="id_star_safe">
								<p class="text_inputName" style="width: 36px;color:#444;">安全星</p>
								<img class="img_icon" id="id_star_safe1" onmouseover="wantToselect('id_star_safe1')" onmouseout="cancelWant('id_star_safe1')" onclick="selectStar('id_star_safe1')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_safe2" onmouseover="wantToselect('id_star_safe2')" onmouseout="cancelWant('id_star_safe2')" onclick="selectStar('id_star_safe2')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_safe3" onmouseover="wantToselect('id_star_safe3')" onmouseout="cancelWant('id_star_safe3')" onclick="selectStar('id_star_safe3')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_safe4"  onmouseover="wantToselect('id_star_safe4')" onmouseout="cancelWant('id_star_safe4')" onclick="selectStar('id_star_safe4')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_safe5"  onmouseover="wantToselect('id_star_safe5')" onmouseout="cancelWant('id_star_safe5')" onclick="selectStar('id_star_safe5')" src="../images/star_gray.png">
								<p class="text_warn" id="id_warn_star_safe" style="display: none;">*</p>
							</div>
							<div class="div_star" id="id_star_law">
								<p class="text_inputName" style="width: 36px;color:#444;">守法星</p>
								<img class="img_icon" id="id_star_law1" onmouseover="wantToselect('id_star_law1')" onmouseout="cancelWant('id_star_law1')" onclick="selectStar('id_star_law1')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_law2" onmouseover="wantToselect('id_star_law2')" onmouseout="cancelWant('id_star_law2')" onclick="selectStar('id_star_law2')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_law3" onmouseover="wantToselect('id_star_law3')" onmouseout="cancelWant('id_star_law3')" onclick="selectStar('id_star_law3')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_law4"  onmouseover="wantToselect('id_star_law4')" onmouseout="cancelWant('id_star_law4')" onclick="selectStar('id_star_law4')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_law5"  onmouseover="wantToselect('id_star_law5')" onmouseout="cancelWant('id_star_law5')" onclick="selectStar('id_star_law5')" src="../images/star_gray.png">
								<p class="text_warn" id="id_warn_star_law" style="display: none;">*</p>
							</div>
							<div class="div_star" id="id_star_honest">
								<p class="text_inputName" style="width: 36px;color:#444;">诚信星</p>
								<img class="img_icon" id="id_star_honest1" onmouseover="wantToselect('id_star_honest1')" onmouseout="cancelWant('id_star_honest1')" onclick="selectStar('id_star_honest1')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_honest2" onmouseover="wantToselect('id_star_honest2')" onmouseout="cancelWant('id_star_honest2')" onclick="selectStar('id_star_honest2')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_honest3" onmouseover="wantToselect('id_star_honest3')" onmouseout="cancelWant('id_star_honest3')" onclick="selectStar('id_star_honest3')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_honest4"  onmouseover="wantToselect('id_star_honest4')" onmouseout="cancelWant('id_star_honest4')" onclick="selectStar('id_star_honest4')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_honest5"  onmouseover="wantToselect('id_star_honest5')" onmouseout="cancelWant('id_star_honest5')" onclick="selectStar('id_star_honest5')" src="../images/star_gray.png">
								<p class="text_warn" id="id_warn_star_honest" style="display: none;">*</p>
							</div>
							<div class="div_star" id="id_star_server">
								<p class="text_inputName" style="width: 36px;color:#444;">服务星</p>
								<img class="img_icon" id="id_star_server1" onmouseover="wantToselect('id_star_server1')" onmouseout="cancelWant('id_star_server1')" onclick="selectStar('id_star_server1')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_server2" onmouseover="wantToselect('id_star_server2')" onmouseout="cancelWant('id_star_server2')" onclick="selectStar('id_star_server2')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_server3" onmouseover="wantToselect('id_star_server3')" onmouseout="cancelWant('id_star_server3')" onclick="selectStar('id_star_server3')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_server4"  onmouseover="wantToselect('id_star_server4')" onmouseout="cancelWant('id_star_server4')" onclick="selectStar('id_star_server4')" src="../images/star_gray.png">
								<img class="img_icon" id="id_star_server5"  onmouseover="wantToselect('id_star_server5')" onmouseout="cancelWant('id_star_server5')" onclick="selectStar('id_star_server5')" src="../images/star_gray.png">
								<p class="text_warn" id="id_warn_star_server" style="display: none;">*</p>
							</div>
						</div>
					</div>
				</div>
			</div>

			<button class="btn_logup" id="id_btnlogstep2_driv" onmouseover="turnToBlur('id_btnlogstep2_driv')" onmouseout="turnToClear('id_btnlogstep2_driv')" onclick="addDriver()">下一步</button>
		</div>
	</div>
	<div class="view_footer">
		<p class="text_footer">Copyright © 2016-2017 titake All Rights Reserved.</p>
	</div>
	<script type="text/javascript">
		var request = new XMLHttpRequest;
		request.open("GET","../ajax/editSession.php?flag=set&name=url_search&url_search="+encodeURI(location.search));
		console.log(encodeURI(location.search));
		request.send();
		request.onreadystatechange = function(){
			if (request.readyState===4) {
				if (request.status===200) {
					console.log(request.responseText);
				}else{
					alert("error:"+request.status);
				}
			}
		}
		exist = true;
		edit = false;
		add_super = false;
		//?usertype=  &upload= &sessionName(idcard_numi)=顺序不可以变
		sessionName = "";
		userType = window.location.search.split("?")[1].split("&")[0].split("=")[1];  
		if (userType.search("super")>=0) {  //任何一种管理
			add_super = true;
			$(function(){
				$("#id_div_star").show();
				$("#id_div_permi").css("border-bottom","dashed 1px #a0a0a0");
				$("#id_idcard_num").show();
				$("#id_email").show()
				$(".view_tab").css("display","none");
				$(".view_title").hide();
				$("#id_btn_goBefore").hide();
			});
		}else{
			$(function(){
				$("#id_div_star").hide();
				$("#id_div_permi").css("border-bottom","none");
				$(".view_tab").css("display","flex");
				$(".view_title").css("display","flex");
				$("#id_btn_goBefore").css("display","flex");
			});
		}
		block = false;
		star_politeSelected = 0;
		star_safeSelected=0;
		star_lawSelected=0;
		star_honestSelected=0;
		star_serverSelected=0;
		uploadSuccess = location.search.split("?")[1].split("&")[1].split("=")[1];
		if (uploadSuccess=="failed") {
			$(function(){
				$("#id_div_photo").css("background-image","url('../images/failed.png')");
				$("#id_warn_photo").html("上传失败，请重试");
				$("#id_warn_photo").show();
			});
		}else if (uploadSuccess!="") {
			$(function(){
				var ImgURL = "url(../uploadImg/"+uploadSuccess+")";
				$("#id_div_photo").css("background-image",ImgURL);
				$("#id_warn_photo").hide();
			});
		}
		//判断是否是edit
		if (window.location.search.split("?")[1].split("&")[2]===undefined) {
			edit=false;
		}else{
			edit=true;
			$(function(){
				$(".view_tab").hide();
				$(".view_title").hide();
				$("#id_btn_goBefore").hide();
			});
			//idcard_numf放在session中
			sessionName = window.location.search.split("?")[1].split("&")[2].split("=")[1];
			var request = new XMLHttpRequest;
			request.open("GET","../ajax/getData_sql.php?flag=sessionName_driver_edit&sessionName="+sessionName);
			request.send();
			request.onreadystatechange = function(){
				if (request.readyState===4) {
					if (request.status===200) {
						var response = JSON.parse(request.responseText);
						if (response.failed==true) {
							console.log(response.reason);
							alert(response.reason);
						}else{
							$(function(){
								$("#id_idcard_num").val(response.idcard_num);
								$("#id_username").val(response.username);
								var selector = "#id_sex>option[value='"+response.sex+"']";
								$(selector).attr("selected",true);
								$("#id_driveLicence_id").val(response.driveLicence_id);
								$("#id_driverLicence_num").val(response.driverLicence_num);
								$("#id_date_getLice").val(response.date_getLice);
								var cars_permi =response.cars_permi;
								if (cars_permi.search("A1")>=0) {
									$("#id_A1").attr("checked",true);
								}
								if(cars_permi.search("A2")>=0){
									$("#id_A2").attr("checked",true);
								}
								if(cars_permi.search("A3")>=0){
									$("#id_A3").attr("checked",true);
								}
								if(cars_permi.search("B1")>=0){
									$("#id_B1").attr("checked",true);
								}
								if(cars_permi.search("B2")>=0){
									$("#id_B2").attr("checked",true);
								}
								if(cars_permi.search("C1")>=0){
									$("#id_C1").attr("checked",true);
								}
								if(cars_permi.search("C2")>=0){
									$("#id_C2").attr("checked",true);
								}
								if(cars_permi.search("C3")>=0){
									$("#id_C3").attr("checked",true);
								}
								if(cars_permi.search("E")>=0){
									$("#id_E").attr("checked",true);
								}
								$("#id_job_permi_id").val(response.job_permi_id);
								selector= "#id_job_permi_classify>option[value=']"+response.job_permi_classify+"']";
								$(selector).attr("selected",true);
								$("#id_job_permi_date").val(response.job_permi_date);
								$("#id_email").val(response.email);
								$("#id_phonenum").val(response.phonenum);
								$("#id_address").val(response.address);
								uploadSuccess = response.picture;
								var ImgURL="url(../uploadImg/"+uploadSuccess+")";
								$("#id_div_photo").css("background-image",ImgURL);
								block = response.ifblock;
								if (block==1) {
									block = true;
									$(function(){
										$(".div_star > p").css("color","#bbb");
										$(".btn_block").html("取消加入黑名单");
									});
								}else{
									block = false;
									$(function(){
										$(".div_star > p").css("color","#444");
										$(".btn_block").html("加入黑名单");
									});
									star_politeSelected = response.star_polite;
									star_safeSelected = response.star_safe;
									star_lawSelected= response.star_law;
									star_honestSelected = response.star_honest;
									star_serverSelected = response.star_server;
									console.log(star_politeSelected);
									var i=1;
									while(i<=star_politeSelected){
										var id = 'id_star_polite'+i;
										document.getElementById(id).src="../images/star_gold.png";
										i++;
									}
									i=1;
									while(i<=star_safeSelected){
										var id = 'id_star_safe'+i;
										document.getElementById(id).src="../images/star_gold.png";
										i++;
									}
									i=1;
									while(i<=star_lawSelected){
										var id = 'id_star_law'+i;
										document.getElementById(id).src="../images/star_gold.png";
										i++;
									}
									i=1;
									while(i<=star_honestSelected){
										var id = 'id_star_honest'+i;
										document.getElementById(id).src="../images/star_gold.png";
										i++;
									}
									i=1;
									while(i<=star_serverSelected){
										var id = 'id_star_server'+i;
										document.getElementById(id).src="../images/star_gold.png";
										i++;
									}
								}
							});
						}
					}else{
						alert("error:"+request.status);
					}
				}
			}
		}
		function selectStar(starID){
			if (!block) {
				var i = starID.substr(starID.length-1,1);
				i = parseInt(i);
				var starSelected = i;
				i++;
				while(i<=5){
					var id = starID.substr(0,starID.length-1)+i;
					document.getElementById(id).src = "../images/star_gray.png";
					i++;
				}
				i = starSelected;
				while(i>0){
					var id = starID.substr(0,starID.length-1)+i;
					document.getElementById(id).src = "../images/star_gold.png";
					i--;
				}
				switch(starID.substr(0,starID.length-1)){
					case "id_star_polite":
						star_politeSelected=starSelected;
						break;
					case "id_star_safe":
						star_safeSelected=starSelected;
						break;
					case "id_star_law":
						star_lawSelected=starSelected;
						break;
					case "id_star_honest":
						star_honestSelected=starSelected;
						break;
					case "id_star_server":
						star_serverSelected=starSelected;
						break;
				}
			}   //这个函数的封装性不好，回头改一下
		}
		function wantToselect(starID){
			if (!block) {
				var i = starID.substr(starID.length-1,1);
				i = parseInt(i);
				var wantStar = i;
				i++;
				while(i<=5){
					var id = starID.substr(0,starID.length-1)+i;
					document.getElementById(id).src = "../images/star_gray.png";
					i++;
				}
				i = wantStar;
				while(i>0){
					var id = starID.substr(0,starID.length-1)+i;
					document.getElementById(id).src = "../images/star_gold.png";
					i--;
				}
			} //这个函数的封装性不好，回头改一下
		}
		function cancelWant(starID){
			if (!block) {
				var starSelected=0;
				switch(starID.substr(0,starID.length-1)){
					case "id_star_polite":
						starSelected = star_politeSelected;
						break;
					case "id_star_safe":
						starSelected = star_safeSelected;
						break;
					case "id_star_law":
						starSelected =star_lawSelected;
						break;
					case "id_star_honest":
						starSelected =star_honestSelected;
						break;
					case "id_star_server":
						starSelected =star_serverSelected;
						break;
				}
				var i = parseInt(starID.substr(starID.length-1,1));
				if (!starSelected) {
					while(i>0){
						var id = starID.substr(0,starID.length-1)+i;
						document.getElementById(id).src = "../images/star_gray.png";
						i--;
					}
				}else if (i!=starSelected) {
					while(i>starSelected){
						var id = starID.substr(0,starID.length-1)+i;
						document.getElementById(id).src = "../images/star_gray.png";
						i--;
					}
					i=starSelected;
					while(i>0){
						var id = starID.substr(0,starID.length-1)+i;
						document.getElementById(id).src = "../images/star_gold.png";
						i--;
					}
				}
			}  //这个函数的封装性不好，回头改一下
		}
		function turnBlock(){
			if (block) {
				block = false;
				$(function(){
					$(".div_star > p").css("color","#444");
					$(".btn_block").html("加入黑名单");
				});
			}else{
				block = true;
				$(function(){
					$(".div_star > p").css("color","#bbb");
					$(".btn_block").html("取消加入黑名单");
				});
			}
		}
		function checkStar(){
			var donuNum = 0;
			if (star_politeSelected==0) {
				document.getElementById("id_warn_star_polite").display = "block";
			}else{
				doneNum++;
				document.getElementById("id_warn_star_polite").display = "none";
			}
			if (star_safeSelected==0) {
				document.getElementById("id_warn_star_safe").display = "block";
			}else{
				doneNum++;
				document.getElementById("id_warn_star_safe").display = "none";
			}
			if (star_lawSelected==0) {
				document.getElementById("id_warn_star_law").display = "block";
			}else{
				doneNum++;
				document.getElementById("id_warn_star_law").display = "none";
			}
			if (star_honestSelected==0) {
				document.getElementById("id_warn_star_honest").display = "block";
			}else{
				doneNum++;
				document.getElementById("id_warn_star_honest").display = "none";
			}
			if (star_serverSelected==0) {
				document.getElementById("id_warn_star_server").display = "block";
			}else{
				doneNum++;
				document.getElementById("id_warn_star_server").display = "none";
			}

			if (doneNum===5) {  
				return true;
			}else{
				return false;
			}
		}
		function checkPhoto(){
			if (uploadSuccess=="") {
				$(function(){
					$("#id_warn_photo").html("请先上传照片！");
					$("#id_warn_photo").show();
				});
			}
		}
		
		//编辑的都有哪些
		changes = "";
		function change(OBJ){
			if (edit==true) {
				var flag = OBJ.id.substr(3,OBJ.id.length-3);  //substr(start ,length)
				if (changes.search(flag)<0) {
					changes = changes+","+flag;
				}
			}
		}
		changes_select = "";
		function change_select(OBJ){
			if (edit==true) {
				var flag = OBJ.id.substr(3,OBJ.id.length-3);  //substr(start ,length)
				if (changes_select.search(flag)<0) {
					changes_select = changes_select+","+flag;
				}
			}
		}
		//获得准驾车型
		function getCarsPermi(){
			var permi = "";
			var permiNum = 0;
			if (document.getElementById("id_A1").checked) {
				permi = "A1";
				permiNum++;
			}
			if (document.getElementById("id_A2").checked) {
				if (permiNum>0) {
					permi = permi+",A2";
				}else{
					permi = "A2";
				}
				permiNum++;
			}
			if (document.getElementById("id_A3").checked) {
				if (permiNum>0) {
					permi = permi+",A3";
				}else{
					permi = "A3";
				}
				permiNum++;
			}
			if (document.getElementById("id_B1").checked) {
				if (permiNum>0) {
					permi = permi+",B1";
				}else{
					permi = "B1";
				}
				permiNum++;
			}
			if (document.getElementById("id_B2").checked) {
				if (permiNum>0) {
					permi = permi+",B2";
				}else{
					permi = "B2";
				}
				permiNum++;
			}
			if (document.getElementById("id_C1").checked) {
				if (permiNum>0) {
					permi = permi+",C1";
				}else{
					permi = "C1";
				}
				permiNum++;
			}
			if (document.getElementById("id_C2").checked) {
				if (permiNum>0) {
					permi = permi+",C2";
				}else{
					permi = "C2";
				}
				permiNum++;
			}
			if (document.getElementById("id_C3").checked) {
				if (permiNum>0) {
					permi = permi+",C3";
				}else{
					permi = "C3";
				}
				permiNum++;
			}
			if (document.getElementById("id_E").checked) {
				if (permiNum>0) {
					permi = permi+",E";
				}else{
					permi = "E";
				}
				permiNum++;
			}
			return permi;
		}
		function addDriver(){
			console.log(edit);
			if (edit==true) {
				console.log(edit);
				changes = changes.substr(1,changes.length-1);
				var columns;
				var sql = "update tb_driver set ";
				if (changes.length>0) {
					columns = changes.split(",");
					for (var i = 0; i <columns.length; i++) {
						sql = sql+columns[i]+"='"+document.getElementById("id_"+columns[i]).value+"',"
					}
				}
				if (changes_select>0) {
					columns = changes.split(",");
					for (var i = 0; i <columns.length; i++) {
						var selects = document.getElementById("id_"+columns[i]);
						var sindex = selects.selectedIndex;
						sql = sql+columns[i]+"='"+selects.options[sindex].value+"',"
					}
				}
				sql = sql+"cars_permi='"+getCarsPermi()+"',star_polite="+star_politeSelected+",star_safe="+star_safeSelected+",star_law="+star_lawSelected+",star_honest="+star_honestSelected+",star_server="+star_serverSelected+" where idcard_num=";
				console.log(sql);
				var request = new XMLHttpRequest;
				request.open("POST","../ajax/updateDB.php",true);
				request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
				request.send("sql="+sql+"&sessionName="+sessionName+"&flag=update_session");
				request.onreadystatechange = function(){
					if (request.readyState===4) {
						if (request.status===200) {
							var result = request.responseText;
							console.log(result);
							alert(result);
							if (result=="更新成功") {
								window.close();
							}
						}else{
							alert("error:"+request.status);
						}
					}
				}
			}else{
				var done = false;
				var doneNum = 0;

				if (uploadSuccess=="") {
					document.getElementById("id_warn_photo").innerHtml = "*";
					document.getElementById("id_warn_photo").style.display = "block";
				}else if (uploadSuccess!="failed") {}{
					doneNum++;
					document.getElementById("id_warn_photo").style.display = "none";
				}

				var username = document.getElementById("id_username").value;
				if (username.length==0) {
					document.getElementById("id_warn_name").style.display = "block";
				}else{
					document.getElementById("id_warn_name").style.display ="none";
					doneNum++;
				}
				var sindex;
				var sexs = document.getElementById("id_sex");
				sindex = sexs.selectedIndex;
				var sex = sexs.options[sindex].value;

				var phonenum = document.getElementById("id_phonenum").value;
				if (phonenum.length==0) {
					document.getElementById("id_warn_phone").style.display = "block";
				}else{
					document.getElementById("id_warn_phone").style.display ="none";
					doneNum++;
				}

				var address = document.getElementById("id_address").value;
				if (address.length==0) {
					document.getElementById("id_warn_address").style.display = "block";
				}else{
					document.getElementById("id_warn_address").style.display ="none";
					doneNum++;
				}

				var driveLicence_id = document.getElementById("id_driveLicence_id").value;
				var date_getLice = document.getElementById("id_date_getLice").value;
				if (driveLicence_id.length==0 ||date_getLice==0) {
					document.getElementById("id_warn_driveLicence").style.display = "block";
				}else{
					document.getElementById("id_warn_driveLicence").style.display ="none";
					doneNum++;
				}

				var driverLicence_num = document.getElementById("id_driverLicence_num").value;
				var cars_permi = getCarsPermi();
				if (driverLicence_num=="" || cars_permi=="") {
					document.getElementById("id_warn_permi").style.display = "block";
				}else{
					document.getElementById("id_warn_permi").style.display ="none";
					doneNum++;
				}

				var job_permi_id = document.getElementById("id_job_permi_id").value;
				var job_permi_date = document.getElementById("id_job_permi_date").value;
				if (job_permi_id=="" || job_permi_date=="") {
					document.getElementById("id_warn_jobPermi").style.display = "block";
				}else{
					document.getElementById("id_warn_jobPermi").style.display ="none";
					doneNum++;
				}

				var job_classifys = document.getElementById("id_job_permi_classify");
				sindex = job_classifys.selectedIndex;
				var job_permi_classify = job_classifys.options[sindex].value;
				if (job_permi_classify=="") {
					document.getElementById("id_warn_jobClassify").style.display = "block";
				}else{
					document.getElementById("id_warn_jobClassify").style.display ="none";
					doneNum++;
				}
				if (userType=="super") {
					var idcard_num = document.getElementById("id_idcard_num").value;
					var email = document.getElementById("id_email");
					if (idcard_num==""){
						document.getElementById("id_warn_name").style.display = "block";
					}else{
						document.getElementById("id_warn_name").style.display = "none";
						doneNum++;
					}
					if(email=="") {
						document.getElementById("id_warn_phone").style.display = "block";
					}else{
						document.getElementById("id_warn_phone").style.display = "none";
						doneNum++;
					}
					if (doneNum===10) {
						done = true;
					}else{
						done =false;
					}
					if (!block) {
						done = done & checkStar();
					}
				}else if (doneNum===8) {
					done = true;
				}else{
					done = false;
				}

				
				if (block) {
					var ifblock = 1;
				}else{
					var ifblock = 0;
				}
				if (done) {
					if (userType=="super") {
						var request = new XMLHttpRequest;
						request.open("POST","../ajax/WriteDB.php",true);
						request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
						request.send("idcard_num="+idcard_num+
							"&username="+username+
							"&sex="+sex+
							"&driveLicence_id="+driveLicence_id+
							"&driverLicence_num="+driverLicence_num+
							"&date_getLice="+date_getLice+
							"&cars_permi="+cars_permi+
							"&job_permi_id="+job_permi_id+
							"&job_permi_classify="+job_permi_classify+
							"&job_permi_date="+job_permi_date+
							"&phonenum="+phonenum+
							"&email="+email+
							"&address="+address+
							"&picture="+uploadSuccess+
							"&ifblock="+ifblock+
							"&star_polite="+star_politeSelected+
							"&star_safe="+star_safeSelected+
							"&star_law="+star_lawSelected+
							"&star_honest="+star_honestSelected+
							"&star_server="+star_serverSelected+
							"&flag=add_driver_super");
						request.onreadystatechange = function(){
							if (request.readyState===4) {
								if (request.status===200) {
									var response = JSON.parse(request.responseText);
									if (response.success) {
										alert("添加成功");
										window.close();
									}else{
										alert("添加失败："+response.reason);
									}
								}else{
									alert("error:"+request.status);
								}
							}
						}
					}else{
						var request = new XMLHttpRequest;
						request.open("POST","../ajax/WriteDB.php",true);
						request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
						request.send("username="+username+
							"&sex="+sex+
							"&driveLicence_id="+driveLicence_id+
							"&driverLicence_num="+driverLicence_num+
							"&date_getLice="+date_getLice+
							"&cars_permi="+cars_permi+
							"&job_permi_id="+job_permi_id+
							"&job_permi_classify="+job_permi_classify+
							"&job_permi_date="+job_permi_date+
							"&phonenum="+phonenum+
							"&address="+address+
							"&picture="+uploadSuccess+
							"&ifblock="+ifblock+
							"&star_polite="+star_politeSelected+
							"&star_safe="+star_safeSelected+
							"&star_law="+star_lawSelected+
							"&star_honest="+star_honestSelected+
							"&star_server="+star_serverSelected+
							"&flag=add_driver");
						request.onreadystatechange = function(){
							if (request.readyState===4) {
								if (request.status===200) {
									var response = JSON.parse(request.responseText);
									if (response.success) {
										console.log("注册成功");
										openWindow("hello.html");
									}else{
										alert("注册失败："+response.reason);
									}
								}else{
									alert("error:"+request.status);
								}
							}
						}
					}
				}
			}
			
		}
	</script>
</body>
</html>